{% extends 'crm/main.html' %}

{% block content %}
{% if request.user.groups.all.0.name == 'Администрация' %}
<script src="/static/material/code/highcharts.js"></script>
<script src="/static/material/code/highcharts-3d.js"></script>
<script src="/static/material/code/modules/cylinder.js"></script>
<style>.btn, .btn-large, .btn-small, .btn-flat {
    height: unset;}
text.highcharts-credits {
    display: none;
}
svg.highcharts-root {
    font-family: 'Montserrat', sans-serif !important;
}	
	</style>
<div class="row">
                    <!-- column -->
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
		  <div id="container2" style="height: 400px; max-width: 500px; margin: 0 auto"></div>
 		<script type="text/javascript">

// Build the chart
Highcharts.chart('container2', {
    chart: {
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie'
    },
    title: {
        text: 'Объекты в базе'
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.y} шт.</b>'
    },
    plotOptions: {
        pie: {
allowPointSelect: true,
            cursor: 'pointer',
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.y} ',
            },
            showInLegend: true
        }
    },
    series: [{
        name: 'Объекты',
        colorByPoint: true,
        data: [{
            name: 'Студии',
            y: {{ tstcount }},
            sliced: true,
            selected: true
        }, {
            name: 'Однокомнатные',
            y: {{ tonecount }}
        }, {
            name: 'Двухкомнатные',
            y: {{ ttwo_count }}
        }, {
            name: 'Трехкомнатные',
            y: {{ ttreecount }}
        }, {
            name: 'Многокомнатные',
            y: {{ tmanycount }}
        }, {
            name: 'Дома',
            y: {{ thouse_count }}
        }]
    }]
});
		</script>
	<!-- Однокомнатные: {{ tOneCrs }} руб. <br> Двухкомнатные: {{ tTwoCrs }}  руб. <br>Трехкомнатные {{ tTreCrs }} руб. -->	
							
 
	
                                </div>
                            </div>
                        </div>

                    <!-- column -->
                    <!-- column -->
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
<div id="container" style="height: 400px; max-width: 500px; margin: 0 auto;"></div>


		<script type="text/javascript">

Highcharts.chart('container', {
    chart: {
        type: 'column',
        options3d: {
            enabled: true,
            alpha: 7,
            beta: -10,
            depth: 70,
			viewDistance: 25
        }
    },
    title: {
        text: 'Посетители'
    },
    subtitle: {
        text: 'Посещения за сегодня: {{ tc|safe }}'
    },
    plotOptions: {
        column: {
            depth: 23
        }
    },
    xAxis: {
        categories: ['{{ y4|safe }}', '{{ y3|safe }}', '{{ y2|safe }}', '{{ y|safe }}'],
        labels: {
            skew3d: true,
            style: {
                fontSize: '12px'
            }
        }
    },
    yAxis: {
        title: {
            text: 'Посетители'
        }
    },
    series: [{
        name: 'Посетители',
        data: [{{ tc4|safe }}, {{ tc3|safe }}, {{ tc2|safe }}, {{ tc|safe }}],
		showInLegend: false
    }]
});
		</script>							
 
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- column -->
</div>					
<div class="row">
                    <!-- column -->
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
							<div id="container4" style="height: 200px; max-width: 500px; margin: 0 auto;"></div>


		<script type="text/javascript">

Highcharts.chart('container4', {
    chart: {
        type: 'pie',
        options3d: {
            enabled: true,
            alpha: 45,
            beta: 0
        }
    },
    title: {
        text: 'Обьявлений в ЦИАН: {{ tcianAll }}'
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.y}</b>'
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            depth: 35,
            dataLabels: {
                enabled: true,
                format: '{point.name}'
            }
        }
    },
    series: [{
        type: 'pie',
        name: 'Объявлений',
        data: [
            {
                name: 'Адлер',
                y: {{ tcianA }},
                sliced: true,
                selected: true
            },
            ['Сочи', {{ tCianS  }}]
        ],
		showInLegend: true
    }]
});
		</script>
                            </div>
                        </div>
						
                        <div class="card">
                            <div class="card-body">
<div id="container6" style="height: 200px; max-width: 500px; margin: 0 auto;"></div>


		<script type="text/javascript">

Highcharts.chart('container6', {
    chart: {
        type: 'pie',
        options3d: {
            enabled: true,
            alpha: 45
        }
    },
    title: {
        text: 'Прибыль за месяц'
    },
    
    plotOptions: {
        pie: {
            innerSize: 40,
            depth: 45
        }
    },
    series: [{
        name: 'Сумма',
		showInLegend: true, 
        data: [
            ['Сочи', {{ tssochi|safe  }}],
            ['Адлер', {{ tsadler|safe  }}]
			
        ]
    }]
});
		</script>							

                            </div>
                        </div>						
                    </div>
                    <!-- column -->
					<div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
<div id="container3" style="height: 400px; max-width: 500px; margin: 0 auto;"></div>

		<script type="text/javascript">

Highcharts.chart('container3', {
    chart: {
        type: 'cylinder',
        options3d: {
            enabled: true,
            alpha: 22,
            beta: 10,
            depth: 70,
            viewDistance: 25
        }
    },
    title: {
        text: 'Прибыль компании за полгода'
    },
    plotOptions: {
        series: {
            depth: 25,
            colorByPoint: true
        }
    },
	xAxis: {
        categories: ['{{ tdm1|safe }}', '{{ tdm2|safe }}', '{{ tdm3|safe }}', '{{ tdm4|safe }}', '{{ tdm5|safe }}', '{{ tdm6|safe }}'],
        labels: {
            skew3d: true,
            style: {
                fontSize: '12px'
            }
        }
    },
    yAxis: {
        title: {
            text: 'Сумма'
        }
    },
    series: [{
        data: [{{ tdsum1|safe }}, {{ tdsum2|safe }}, {{ tdsum3|safe }}, {{ tdsum4|safe }}, {{ tdsum5|safe }}, {{ tdsum6|safe }}],
        name: 'Сумма',
        showInLegend: false
    }]
});
		</script>								
					   </div>
                            </div>
                        </div>
                    </div>
                    <!-- column -->

</div>								
                 <!-- row -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title m-b-40">Статистика</h4>
                                <ul class="nav nav-tabs" id="myTab" role="tablist">
                                    <li class="nav-item"> <a class="nav-link active" id="test1-tab" data-toggle="tab" href="#test1" role="tab" aria-controls="test1" aria-expanded="true"><span class="hidden-sm-up"><i class="ti-home"></i></span> <span class="hidden-xs-down">Рейтинг по отделам</span></a> </li>
                                    <li class="nav-item"> <a class="nav-link" id="test2-tab" data-toggle="tab" href="#test2" role="tab" aria-controls="test2"><span class="hidden-sm-up"><i class="ti-user"></i></span> <span class="hidden-xs-down">Сочи</span></a></li>
                                    <li class="nav-item"> <a class="nav-link" id="test3-tab" data-toggle="tab" href="#test3" role="tab" aria-controls="test3"><span class="hidden-sm-up"><i class="ti-user"></i></span> <span class="hidden-xs-down">Адлер</span></a></li>

                                </ul>
                                <div class="tab-content tabcontent-border p-20" id="myTabContent">
                                    <div role="tabpanel" class="tab-pane fade show active" id="test1" aria-labelledby="test1-tab">
                                        <div class="p-20""><p></p></div>
										<div class="table-responsive">
        <table class="table">
                                        <thead class="bg-success text-white">
          <tr>
              <th>Отдел</th>
              <th>Коммисия</th>
          </tr>
        </thead>
        <tbody>
        {% for rOtd in trOtd %}
          <tr>
            <td>{{ rOtd.otd }}</td>
            <td>{{ rOtd.kommisia }} руб.</td>
          </tr>
        {% endfor %}
        </tbody>
      </table></div>
                                    </div>
                                    <div class="tab-pane fade" id="test2" role="tabpanel" aria-labelledby="test2-tab">
                                        <div class="p-20""><p></p></div>
										<div class="table-responsive">
        <table class="table">
                                        <thead class="bg-info text-white">
<tr>
              <th>ФИО</th>
              <th>Сделок</th>
              <th>Коммисия</th>
              <th>Объектов в ЦРМ</th>
              <th>Объектов в Циан</th>
          </tr>
        </thead>

        <tbody>
        {% for sOtd in tsOtd %}
          <tr>
            <td>{{ sOtd.auth_ful_name }}</td>
            <td>{{ sOtd.sdelok_calc }}</td>
            <td>{{ sOtd.sdelok_sum }}</td>
            <td>{{ sOtd.crm_count }}</td>
            <td>{{ sOtd.cian_count }}</td>
          </tr>
        {% endfor %}
        </tbody></table></div>                                    </div>
                                    <div class="tab-pane fade" id="test3" role="tabpanel" aria-labelledby="test3-tab">
                                        <div class="p-20""><p></p></div>
										<div class="table-responsive">
        <table class="table">
                                        <thead class="bg-primary text-white">
          <tr>
              <th>ФИО</th>
              <th>Сделок</th>
              <th>Коммисия</th>
              <th>Объектов в ЦРМ</th>
              <th>Объектов в Циан</th>
          </tr>
        </thead>

        <tbody>
        {% for aOtd in taOtd %}
          <tr>
            <td>{{ aOtd.auth_ful_name }}</td>
            <td>{{ aOtd.sdelok_calc }}</td>
            <td>{{ aOtd.sdelok_sum }}</td>
            <td>{{ aOtd.crm_count }}</td>
            <td>{{ aOtd.cian_count }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- row -->
 			

{% endif %}
{% endblock %}







